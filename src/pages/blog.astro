---
import Page from "../layouts/Page.astro";
import Footer from "../components/Footer.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Page title="Blog" description="My blog posts and articles">
  <main class="container mx-auto max-w-7xl px-8 py-12">
    <h1 class="text-4xl font-bold text-center mb-4">Blog</h1>
    <p class="text-center text-on-surface-muted mb-12">
      Thoughts, tutorials, and learnings from my journey in tech.
    </p>

    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {
        sortedPosts.map((post) => {
          const formattedDate = post.data.pubDate.toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
          });
          return (
            <a
              href={`/blog/${post.id}.html`}
              class="card p-6 block group no-underline"
            >
              <time
                datetime={post.data.pubDate.toISOString()}
                class="text-on-surface-muted text-sm"
              >
                {formattedDate}
              </time>
              <h2 class="text-xl font-semibold mt-2 mb-3 group-hover:text-primary transition-colors">
                {post.data.title}
              </h2>
              <p class="text-on-surface-muted line-clamp-3">
                {post.data.description}
              </p>
              {post.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mt-4">
                  {post.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="px-2 py-1 text-xs rounded-full bg-primary/10 text-primary">
                      #{tag}
                    </span>
                  ))}
                </div>
              )}
            </a>
          );
        })
      }
    </div>

    {
      sortedPosts.length === 0 && (
        <p class="text-center text-on-surface-muted">
          No blog posts yet. Check back soon!
        </p>
      )
    }
  </main>
  <Footer />
</Page>
